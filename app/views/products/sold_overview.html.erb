<div class="row">
  <div class="col-sm-12">
    <div class="panel panel-default">
      <div class="panel-heading"><%=t".All Products"%></div>
      <div class="panel-body">
        <div class="table-responsive">
          <table class="table">
            <tr>
              <th><%=Product.model_name.human%></th>
              <th><%=t".open_orders"%></th>
              <th><%=t".paid_orders"%></th>
              <th class="sold-to"><%=t".to"%></th>
            </tr>

            <% @products.each do |product| %>
            <tr>
              <td><%=link_to product.name, product %> <span class="text-muted">(<%=number_to_currency product.price%>)</span></td>
              <td><%=product.sold_products.open_orders.length %> <span class="text-muted">(<%=number_to_currency product.sold_products.open_orders.collect{|sold_product|sold_product.price}.sum %>)</span></td>
              <td><%=product.sold_products.paid_orders.length %> <span class="text-muted">(<%=number_to_currency product.sold_products.paid_orders.collect{|sold_product|sold_product.price}.sum %>)</span></td>
              <td class="sold-to"><span class="emails"><%=product.sold_products.open_orders.group_by{|sold_product| sold_product.user.email}.collect{|email, products| "#{email} #{"(#{products.length})" if products.length > 1}"}.join ", " %></span><span class="more">...</span></td>
            </tr>
            <% end %>

            <tr>
              <th></th>
              <th><span style="border-top:4px double #333; padding-left: 5px; padding-right: 5px;"><%=number_to_currency @event.sold_products.open_orders.collect{|sold_product|sold_product.price}.sum %></span></th>
              <th><span style="border-top:4px double #333; padding-left: 5px; padding-right: 5px;"><%=number_to_currency @event.sold_products.paid_orders.collect{|sold_product|sold_product.price}.sum %></span></th>
              <th></th>
            </tr>

          </table>
        </div>
      </div>
    </div>
  </div>
</div>

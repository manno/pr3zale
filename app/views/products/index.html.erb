
<div class="page-header">
  <%= link_to 'New Product', new_product_path, :class => "btn btn-primary" if can? :create, Product.new(:event => @event) %>
  <h1>All the products for <%= @event.name %></h1>
</div>

<%= form_tag orders_path, method: :post do %>

  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <% if can? :create, Order %>
            <th>Quantity</th>
          <% end %>
          <th>Name</th>
          <th>Price</th>
          <th>Tax</th>
          <th>Description</th>
          <% if can? :update, Product.new(:event => @event) %>
            <th colspan="3"></th>
          <% else %>
            <th colspan="1"></th>
          <% end %>
        </tr>
      </thead>

      <tbody>
        <% @products.each do |product| %>
          <tr>
            <% if can? :create, Order %>
              <td>
                <div class="selling" data-product-id="<%=product.id%>" data-name="order[sold_products_attributes][][product_id]">
                  <div class="btn btn-default btn-xs less-products"><span class="fa fa-minus"></span></div>

                  <span class="sells">&nbsp;</span>

                  <div class="btn btn-default btn-xs more-products"><span class="fa fa-plus"></span></div>
                </div>

                <% number_field_tag "order[sold_products_attributes][][product_id]", product.id %>
              </td>
            <% end %>
            <td><%= link_to product.name, product %></td>
            <td><%= product.price %></td>
            <td><%= product.tax %></td>
            <td>
              <% if product.images.length > 0 %>
                <span class="product-previews">
                  <% product.images.each do |image| %>
                    <%=link_to product do
                      image_tag(image.image.url(:thumb), height: "50px")
                    end %>
                  <% end %>
                </span>
              <% end %>
              <%= product.description %>
            </td>
            <td><%= link_to 'Show', product %></td>
            <% if can? :update, product %>
              <td><%= link_to 'Edit', edit_product_path(product) %></td>
              <td><%= link_to 'Destroy', product, method: :delete, data: { confirm: 'Are you sure?' } %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if can? :create, Order %>
    <div class="col-sm-2 col-sm-offset-7">
      <%= submit_tag "Make a reservation >" ,class: "btn btn-primary" %>
    </div>
  <% end %>

<% end %>
